[gd_scene load_steps=9 format=3 uid="uid://q6hc75mf5yat"]

[ext_resource type="Script" uid="uid://dglahxoyqaxsp" path="res://barkley2/scenes/Objects/_interactiveActor/_braincity/_longinusBase/o_wiglaf01.gd" id="1_mso67"]
[ext_resource type="Texture2D" uid="uid://b55mytnsxip30" path="res://barkley2/assets/b2_original/images/merged/s_wiglaf01.png" id="2_drxwa"]
[ext_resource type="Script" uid="uid://brqjwvhoi8eux" path="res://barkley2/resources/B2_Cinema/B2_Script_Legacy.gd" id="2_glpkc"]

[sub_resource type="Resource" id="Resource_t7rvb"]
script = ExtResource("2_glpkc")
original_script = "IF tuberPeel == 3   | GOTO | TUBER_COMPLETE
IF wiglafState == 1 | GOTO | WIGLAF_1
IF wiglafState == 2 | GOTO | WIGLAF_2
IF wiglafState == 3 | GOTO | WIGLAF_3

CUCHU_KILLED
DIALOG | P_NAME      | Wait... are you serious? You want me to take out Cuchulainn? I already did! And I kicked his ass.
DIALOG | Lft. Wiglaf | Already beat him, huh? Proactive thinking, sprout! I like your moxie! I don't usually do this, but I'm willing to overlook your exceptionally poor tuber peeling performance just this once. I'm giving you a field promotion. Congratulations, Private First Class P_NAME!
GOTO   | GAMESMASTER

CUCHU_FIGHT
DIALOG | P_NAME      | Wait... are you serious? You want me to take out Cuchulainn? I've already fought him and it's a suicide mission!
DIALOG | Lft. Wiglaf | Already fought him, huh? Proactive thinking, sprout! I like your moxie, forget about the mission. I don't usually do this, but I'm giving you a field promotion. Congratulations, Private First Class P_NAME!
GOTO   | GAMESMASTER

CUCHU_FAILED
DIALOG | P_NAME      | Wait... are you serious? You want me to take out Cuchulainn? I got to his lair already, but he bopped me pretty bad...
DIALOG | Lft. Wiglaf | Already poked around up there, huh?? Proactive thinking, sprout! I like your moxie, forget about the mission. I don't usually do this, but I'm giving you a field promotion. Congratulations, Private First Class  P_NAME!
GOTO   | GAMESMASTER

GAMESMASTER
DIALOG | P_NAME      | Private First Class? I've never gotten a promotion before...
DIALOG | Lft. Wiglaf | Tell you what, you want to see the Cyberdwarf? You've earned it. Jhodfrey, boot up Benevolent A.I. OS!
DIALOG | Jhodfrey    | Yes, sir! Parsing RAM as we speak.
DIALOG | Lft. Wiglaf | Private First Class P_NAME, you're free to see the Cyberdwarf. Go right through that door.
QUEST  | wiglafMission = 4

WIGLAF_1
DIALOG | Lft. Wiglaf | Private P_NAME! Why in the name of Clispaeth are you sitting around like a sack of wet tubers when you're on Cuchulainn duty? Get out there and shut this malevolent AI down, private! Jhodfrey gave you the OP specs, didn't he? Get moving!

WIGLAF_2
IF cuchuRespawn == 2   | GOTO | MISSION_CUCHU_FIGHT
IF crustDead >= 1      | GOTO | MISSION_CUCHU_KILLED
IF crustFightAny >= 1  | GOTO | MISSION_CUCHU_FIGHT
IF cuchuLairDeath >= 1 | GOTO | MISSION_CUCHU_FIGHT
DIALOG | Lft. Wiglaf   | Private P_NAME! Why in the name of Clispaeth are you sitting around like a sack of wet tubers when you're on Cuchulainn duty? Get out there and shut this malevolent AI down, private! Jhodfrey will give you the OP specs.

MISSION_CUCHU_KILLED
DIALOG | P_NAME      | Private P_NAME reporting for duty! Target Malevolent AI Cuchulainn has been eliminated!
DIALOG | Lft. Wiglaf | Eliminated, huh? Not bad, kid. I liked the cut of your jib the moment you walked in here... scrappy, resilient! You could really teach these good-for-nothings a thing or two about duty and respect! You remind me of a younger Wiglaf... I don't usually do this, but I'm giving you a field promotion. Congratulations, Private First Class P_NAME!
DIALOG | P_NAME      | Private First Class? I've never gotten a promotion before...
DIALOG | Lft. Wiglaf | You did a great job out there, sprout. Tell you what, enjoy your leave. You've earned it. Jhodfrey, boot up Benevolent A.I. OS!
GOTO   | MISSION_COMPLETE

MISSION_CUCHU_FIGHT
DIALOG | P_NAME = s_port_hoopzAngry | Take him out? `s1`Take him out!?`s0` `s2`What the heck was that!?`s0`
DIALOG | Lft. Wiglaf | Well, well, well, look who came crawling back. You survived, Private! Or I should say, Private First Class. I don't usually do this, but you've got moxie, so I'm giving you a field promotion.
CHOICE | How should I respond?
REPLY  | SUICIDE | That was suicide!
REPLY  | PROMOTE | I've never gotten a promotion...

SUICIDE
DIALOG | P_NAME = s_port_hoopzAngry | Are you outta your flippin' gourd? That was suicide! I could've gotten killed! I almost did get killed!
DIALOG | Lft. Wiglaf | Nonsense! You did a great job out there, sprout. Tell you what, enjoy your leave. You've earned it. Jhodfrey, boot up `mq`Benevolent A.I. OS!`rt`
GOTO   | MISSION_COMPLETE

PROMOTE
DIALOG | P_NAME      | Private First Class? I've never gotten a promotion before...
DIALOG | Lft. Wiglaf | You did a great job out there, sprout. Tell you what, enjoy your leave. You've earned it. Jhodfrey, boot up Benevolent A.I. OS!
GOTO   | MISSION_COMPLETE

MISSION_COMPLETE
DIALOG | Jhodfrey    | Yes, sir! Parsing RAM as we speak.
DIALOG | Lft. Wiglaf | Private First Class P_NAME, you're free to see the `mq`Cyberdwarf.`rt` Go right through that door when you're ready.
PLAYSET | o_bct_cdwarfDoor01 | open | opened
DIALOG | P_NAME      | Sir! Yes sir!
DIALOG | P_NAME = s_port_hoopzHappy | (Finally! Cyberdwarf... I'm coming!)
QUEST  | cdwarfCinema = 1
QUEST  | wiglafState = 3
QUEST  | wiglafMission = 4

WIGLAF_3
DIALOG | Lft. Wiglaf | Private First Class P_NAME! You here to peel tubers or see the Cyberdwarf? Walk right on through that door, sprout!

TUBER_COMPLETE
QUEST  | tuberPeel = 4
MOVETO | o_cts_hoopz | o_cinema10 | MOVE_NORMAL
WAIT   |
USEAT  | SOUTHEAST
WAIT   | o.1
CREATE | o_peeledTubers | 248 | 592
//TODO: remove tubers from inventory
LOOKAT | o_cts_hoopz | o_wiglaf01
DIALOG | P_NAME | Sir! Tubers have been peeled, sir!
DIALOG | Lft. Wiglaf | Well, well, time for a debriefing... let me see them tubers...
WAIT   | 1.5
Emote  | ! | o_wiglaf01
DIALOG | Lft. Wiglaf | What in the name of Clispaeth is going on here? I didn't serve four tours of duty to see tubers this poorly peeled.
DIALOG | P_NAME = s_port_hoopzSad | It-it..._ was my first time peeling tubers...
DIALOG | Lft. Wiglaf | It won't be the last, Private. Practice makes perfect. Get back down to the Rootstock and peel them again!
GOTO   | COURAGEBUILDER

COURAGEBUILDER
//TODO: stop the music
Emote  | ! | o_cts_hoopz
SURPRISEAT | o_wiglaf01
WAIT   | 2.0
CHOICE | Stand up or stand down?
REPLY  | STAND_UP   | Stand up in pertinacity.
REPLY  | STAND_DOWN | Stand down in capitulation. 

STAND_DOWN
WAIT   | 0.25
LOOK   | o_cts_hoopz | WEST
WAIT   | 0.25
LOOK   | o_cts_hoopz | SOUTHWEST
WAIT   | 0.25
LOOK   | o_cts_hoopz | SOUTH
WAIT   | 0.25
PLAYSET | o_cts_hoopz | sad0 | sad1
WAIT   | 0
DIALOG | P_NAME = s_port_hoopzSad | (Daggone, I have `sq`peel tubers`rt` all over again??)
//TODO: CRESTFALL EVENT IF wiglafCrestfall == 0
QUEST  | wiglafCrestfall = 1
WAIT   | 4
DIALOG | Lft. Wiglaf | `s1`Well, Private?`s1`
GOTO   | COURAGEBUILDER

STAND_UP
DIALOG | P_NAME = s_port_hoopzAngry | I'm not going to peel any more tubers, sir.
DIALOG | Lft. Wiglaf | What are you saying to a superior officer, Private?!
DIALOG | P_NAME      | I'm not here to peel any tubers, sir. My name is P_NAME, I was rescued by L.O.N.G.I.N.U.S. members, and they mentioned that the whole operation was ordered by `mq`The Cyberdwarf.`rt`
DIALOG | Lft. Wiglaf | Private P_NAME, huh? I have no idea what you are talking about. 
DIALOG | Lft. Wiglaf | You want to meet `mq`The Cyberdwarf?`rt` Not with a `sq`rank like that,`rt` you won't. But three more sorties and you get your `kw`promotion.`rt` 
DIALOG | Lft. Wiglaf | Ready for your mission briefing, Private?
DIALOG | P_NAME      | Yes sir, Lft. Wiglaf!
DIALOG | Lft. Wiglaf | Okay, here it is. We've been receiving reports of a `sq`Malevolent AI,`rt` one `sq`Cuchulainn`rt` terrorizing L.O.N.G.I.N.U.S. members and dwarf civilians. Your first task... take him out, and rid the `kw`Necron 7`rt` of his tyranny!
IF crustDead >= 1      | GOTO | CUCHU_KILLED
IF crustFightAny >= 1  | GOTO | CUCHU_FIGHT
IF cuchuLairDeath >= 1 | GOTO | CUCHU_FAILED
DIALOG | P_NAME      | Um, don't you think...
DIALOG | Lft. Wiglaf | That's right, _I_ think! And you act!
DIALOG | P_NAME      | Sir, yes sir!
DIALOG | Lft. Wiglaf | Now then Private, our most current intelligence puts `kw`Cuchulainn,`rt` henceforth known as `kw`/'Big Boy/'`rt` at approximately Level 666 of Necron 7, codenamed `mq`/'The Hen House/'.`rt` The only known incursion route? Well that's the `kw`Express Elevator`rt` in the bog. Your mission is this:
DIALOG | Lft. Wiglaf | Under codename `sq`/'Knife/'`rt`, rendezvous with operative `kw`/'Variable/'`rt` and infiltrate `kw`/'The Hen House/'`rt` and take out `kw`/'Big Boy./'`rt`
DIALOG | P_NAME      | Knife, Variable, Hen House, Big Boy...
DIALOG | P_NAME = s_port_hoopzSmirk | GOT IT!
DIALOG | Lft. Wiglaf | What was that Private?
DIALOG | P_NAME      | Sir, Mission Accepted sir!
DIALOG | Lft. Wiglaf | That's what I thought, Private. Now, Jhodfrey will give you the OP specs. Pull this one off and you'll be wearing some shiny brass in no time.
WAIT   | 0.25
LOOK   | o_cts_hoopz | WEST
WAIT   | 0.25
LOOK   | o_cts_hoopz | SOUTHWEST
WAIT   | 0.25
LOOK   | o_cts_hoopz | SOUTH
WAIT   | 0.25
PLAYSET | o_cts_hoopz | sad0 | sad1
DIALOG | P_NAME = s_port_hoopzSad | Cyberdwarf... 
WAIT   | 1.0
LOOKAT | o_cts_hoopz | SOUTH
DIALOG | P_NAME = s_port_hoopzHappy | `mq`I'm coming!`rt`
QUEST  | wiglafMission = 1
EXIT   |"
metadata/_custom_type_script = "uid://brqjwvhoi8eux"

[sub_resource type="AtlasTexture" id="AtlasTexture_glpkc"]
atlas = ExtResource("2_drxwa")
region = Rect2(0, 0, 34, 63)

[sub_resource type="SpriteFrames" id="SpriteFrames_t7rvb"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_glpkc")
}],
"loop": true,
"name": &"default",
"speed": 5.0
}]

[sub_resource type="CircleShape2D" id="CircleShape2D_j60sc"]
radius = 13.0

[sub_resource type="RectangleShape2D" id="RectangleShape2D_j60sc"]
size = Vector2(29, 60)

[node name="o_wiglaf01" type="CharacterBody2D" node_paths=PackedStringArray("mouse_detection_area", "ActorAnim", "ActorCol")]
script = ExtResource("1_mso67")
mouse_detection_area = NodePath("ActorInteract")
cutscene_script = SubResource("Resource_t7rvb")
ActorAnim = NodePath("ActorAnim")
ActorCol = NodePath("ActorCol")
can_move_around = false

[node name="ActorAnim" type="AnimatedSprite2D" parent="."]
use_parent_material = true
sprite_frames = SubResource("SpriteFrames_t7rvb")
centered = false
offset = Vector2(-17, -54)
metadata/default = {
"bbox_bottom": "62",
"bbox_left": "0",
"bbox_right": "33",
"bbox_top": "0",
"frames": ["images\\s_wiglaf01_0.png", "images\\s_wiglaf01_1.png"],
"height": "63",
"name": "s_wiglaf01",
"width": "34",
"xorig": "17",
"yorigin": "54"
}

[node name="ActorCol" type="CollisionShape2D" parent="."]
position = Vector2(0, -3)
shape = SubResource("CircleShape2D_j60sc")

[node name="ActorInteract" type="Area2D" parent="."]
position = Vector2(0, -11)

[node name="CollisionShape2D" type="CollisionShape2D" parent="ActorInteract"]
position = Vector2(0.5, -12)
shape = SubResource("RectangleShape2D_j60sc")
